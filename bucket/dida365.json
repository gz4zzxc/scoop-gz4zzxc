{
  "version": "6.3.5.0",
  "description": "滴答清单是一款高效的待办事项和时间管理应用，支持多平台同步和团队协作",
  "homepage": "https://dida365.com/",
  "license": "Proprietary",
  "notes": [
    "此包使用官方 Windows 安装程序 (NSIS)，支持 /S 静默安装",
    "⚠️  安装时会弹出 Windows UAC (用户账户控制) 权限对话框，这是正常的系统安全机制",
    "请在 UAC 对话框中点击「是」以允许安装，这不会影响系统安全",
    "首次启动会创建用户数据目录于 %APPDATA% 或 %LOCALAPPDATA%",
    "更新时如有进程占用，请先退出托盘后再执行 scoop update dida365",
    "如需完全静默安装，请以管理员身份运行 PowerShell 后再执行 scoop install"
  ],
  "url": "https://cdn.dida365.cn/download/win64/dida_win_setup_release_x64_6350.exe",
  "hash": "46a57e5c04a954e77796d0e2d78b6f8eece7c5f57e27f715987dda96af9561a8",
  "pre_install": [
    "Write-Host '⚠️  滴答清单需要管理员权限进行安装' -ForegroundColor Yellow",
    "Write-Host '如果弹出 UAC 权限对话框，请点击「是」继续安装' -ForegroundColor Yellow",
    "Write-Host '这是 Windows 系统安全机制，无法绕过' -ForegroundColor Cyan"
  ],
  "installer": {
    "script": [
      "$exe = Get-ChildItem $dir -Filter 'dida_win_setup_release_x64_*.exe' | Select-Object -First 1 | ForEach-Object { $_.FullName }",
      "if(-not $exe){ throw '未找到安装文件 (*.exe)' }",
      "Write-Host '开始静默安装 滴答清单...' -ForegroundColor Cyan",
      "try {",
      "  $process = Start-Process -FilePath $exe -ArgumentList '/S', '/SP-', '/NORESTART' -Wait -PassThru",
      "  if ($process.ExitCode -eq 0) {",
      "    Write-Host '✅ 安装成功！' -ForegroundColor Green",
      "  } else {",
      "    Write-Host '❌ 安装失败，退出代码: ' + $process.ExitCode -ForegroundColor Red",
      "  }",
      "} catch {",
      "  Write-Host '❌ 安装过程出错: ' + $_.Exception.Message -ForegroundColor Red",
      "  throw",
      "}"
    ]
  },
  "uninstaller": {
    "script": [
      "Write-Host '尝试静默卸载 滴答清单...' -ForegroundColor Cyan",
      "$regPaths = 'HKCU:','HKLM:' | ForEach-Object { Join-Path $_ 'SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall' }",
      "$entry = Get-ChildItem $regPaths -ErrorAction SilentlyContinue | Get-ItemProperty | Where-Object { $_.DisplayName -match '滴答清单' -or $_.DisplayName -match 'TickTick' } | Select-Object -First 1",
      "if($entry -and $entry.UninstallString){",
      "  $cmd = $entry.UninstallString",
      "  if($cmd -match '^(\\\"[^\\\"]+\\\")'){ $path=$matches[1].Trim('\\\"') } else { $path = ($cmd -split ' ')[0] }",
      "  if(Test-Path $path){ Start-Process -FilePath $path -ArgumentList '/S' -Wait; Write-Host '卸载完成' -ForegroundColor Green } else { Write-Host '未找到卸载程序: ' $path -ForegroundColor Yellow }",
      "} else { Write-Host '未找到卸载信息 (可能已被移除)' -ForegroundColor Yellow }"
    ]
  },
  "checkver": {
    "url": "https://dida365.com/download/windows/TickTick-Desktop-Setup.exe",
    "regex": "dida_win_setup_release_x64_([0-9]+)\\.exe"
  },
  "autoupdate": {
    "url": "https://cdn.dida365.cn/download/win64/dida_win_setup_release_x64_$version.exe"
  }
}