{
    "version": "25.8.0.0",
    "description": "权威英语词典软件，支持屏幕取词与真人发音",
    "homepage": "https://www.eudic.net/",
    "license": "Proprietary",
    "notes": [
        "欧路词典官方桌面客户端",
        "支持单词真人发音、英语翻译、跨软件取词等功能",
        "内置权威英语词典，支持离线查词",
        "支持生词本、笔记、荧光笔标记等学习功能",
        "多平台同步，支持学习记录云端同步",
        "安装后可在开始菜单或桌面找到欧路词典图标"
    ],
    "architecture": {
        "64bit": {
            "url": "https://static.frdic.com/pkg/eudic_win.zip",
            "hash": "71351d9cef9db77e5063a2928678b6b7755b3af9dac61c176b66675aee29dfb2"
        }
    },
    "pre_install": "Write-Host 'Preparing to install 欧路词典...' -ForegroundColor Yellow",
    "installer": {
        "script": [
            "Write-Host 'Installing 欧路词典...' -ForegroundColor Green",
            "# Extract the eudic_win.exe using 7zip",
            "if (Test-Path \"$dir\\eudic_win.exe\") {",
            "    Write-Host 'Extracting eudic_win.exe...' -ForegroundColor Cyan",
            "    Expand-7ZipArchive \"$dir\\eudic_win.exe\" \"$dir\\\" -Removal",
            "    if (Test-Path \"$dir\\app.7z\") {",
            "        Write-Host 'Extracting app.7z...' -ForegroundColor Cyan",
            "        Expand-7ZipArchive \"$dir\\app.7z\" \"$dir\" -Removal",
            "    }",
            "    # Clean up unnecessary files",
            "    @('uninst.exe.nsis', '$PLUGINSDIR') | ForEach-Object {",
            "        if (Test-Path \"$dir\\$_\") {",
            "            Remove-Item \"$dir\\$_\" -Force -Recurse -ErrorAction SilentlyContinue",
            "        }",
            "    }",
            "    Write-Host '✓ 欧路词典 installation completed.' -ForegroundColor Green",
            "} else {",
            "    Write-Host '✗ eudic_win.exe not found, installation failed' -ForegroundColor Red",
            "    exit 1",
            "}"
        ]
    },
    "bin": "eudic.exe",
    "shortcuts": [
        [
            "eudic.exe",
            "欧路词典"
        ]
    ],
    "post_install": [
        "Write-Host '欧路词典已安装完成！' -ForegroundColor Cyan",
        "Write-Host '您可以在开始菜单或桌面找到欧路词典图标' -ForegroundColor Yellow",
        "Write-Host '首次使用建议登录账号以同步学习记录' -ForegroundColor Yellow",
        "Write-Host '支持跨软件取词、划词搜索等便捷功能' -ForegroundColor Yellow"
    ],
    "uninstaller": {
        "##": "Checks for system-level uninstaller in case the app registered itself or was previously installed.",
        "script": [
            "Write-Host 'Uninstalling 欧路词典...' -ForegroundColor Yellow",
            "$uninstallPath = Get-ChildItem \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\" | Get-ItemProperty | Where-Object { $_.DisplayName -like '*欧路词典*' -or $_.DisplayName -like '*Eudic*' } | Select-Object -ExpandProperty UninstallString",
            "if ($uninstallPath) {",
            "    if ($uninstallPath -match '\"(.+?)\"') {",
            "        $uninstallExe = $matches[1]",
            "        Start-Process -Wait -FilePath $uninstallExe -ArgumentList '/S' -PassThru | Out-Null",
            "        Write-Host '欧路词典 uninstalled successfully.' -ForegroundColor Green",
            "    } else {",
            "        Write-Host 'Could not find uninstaller.' -ForegroundColor Red",
            "    }",
            "} else {",
            "    Write-Host '欧路词典 is not installed.' -ForegroundColor Yellow",
            "}"
        ]
    },
    "checkver": {
        "script": [
            "$url = 'https://static.frdic.com/pkg/eudic_win.zip'",
            "$tmp = cache_path 'eudic' '64bit' $url",
            "Invoke-WebRequest $url -OutFile $tmp -UseBasicParsing",
            "$dest = Join-Path (Split-Path $tmp) 'eudic_extract'",
            "if (Test-Path $dest) { try { Remove-Item -Recurse -Force $dest -ErrorAction Stop } catch { } }",
            "Add-Type -AssemblyName System.IO.Compression.FileSystem",
            "[System.IO.Compression.ZipFile]::ExtractToDirectory($tmp, $dest)",
            "$exe = Get-ChildItem -Path $dest -Recurse -Filter 'eudic_win.exe' | Select-Object -First 1",
            "if (-not $exe) { throw 'eudic_win.exe not found in zip' }",
            "$product = (Get-Item $exe.FullName).VersionInfo.ProductVersion",
            "$file = (Get-Item $exe.FullName).VersionInfo.FileVersion",
            "if (-not $product) { throw 'Cannot read ProductVersion from eudic_win.exe' }",
            "Write-Host ('eudic VersionInfo => ProductVersion=' + $product + '; FileVersion=' + $file) -ForegroundColor Yellow",
            "$product"
        ],
        "regex": "([\\d.]+)"
    },
    "autoupdate": {
        "architecture": {
            "64bit": {
                "url": "https://static.frdic.com/pkg/eudic_win.zip"
            }
        },
        "hash": {
            "mode": "download"
        }
    }
}
